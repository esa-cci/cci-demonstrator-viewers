{"version":3,"kind":"Notebook","sha256":"7e9ab23f5dc7781473dcf9edb76482672bfbf31aeca1553865a5fd760bd67656","slug":"external-notebooks.esa-cci.ect-demonstrators.demonstrators.d3-js.d3-js-visualize-4d-data","location":"/external_notebooks/esa-cci/ect-demonstrators/demonstrators/D3_js/D3_js_Visualize_4D_Data.ipynb","dependencies":[],"frontmatter":{"title":"Visualizing 4-dimensional Data with Altair and Plotly","content_includes_title":false,"kernelspec":{"name":"python3","display_name":"Python 3 (ipykernel)","language":"python"},"github":"https://github.com/esa-cci/cci-notebook-viewers","subject":"CCI Examples","numbering":{"title":{"offset":5}},"source_url":"https://github.com/esa-cci/cci-notebook-viewers/blob/main/external_notebooks/esa-cci/ect-demonstrators/demonstrators/D3_js/D3_js_Visualize_4D_Data.ipynb","edit_url":"https://github.com/esa-cci/cci-notebook-viewers/edit/main/external_notebooks/esa-cci/ect-demonstrators/demonstrators/D3_js/D3_js_Visualize_4D_Data.ipynb","exports":[{"format":"ipynb","filename":"D3_js_Visualize_4D_Data.ipynb","url":"/cci-demonstrator-viewers/build/D3_js_Visualize_4D_D-27bdfa1d17070d0766b7ca12d9dbcbbe.ipynb"}]},"widgets":{},"mdast":{"type":"root","children":[{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"This notebook is one of three notebooks that serve to show how the ESA CCI Toolbox can be used with D3.js. Here, we will show how CCI Ozone Data, which has a fourth dimension beyond time. latitude, and longitude, can be visualised using charts from Altair and Plotly. Several preprocessing steps are applied, partly using operations from the CCI Toolbox.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"NiBjGwr85R"}],"key":"Rpa6o37Xja"}],"key":"d0RK3N8Ot2"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Install altair and plotly it into your Python environment if you haven’t already done so:","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Buoiwla6TZ"}],"key":"N1EWpiXCUn"}],"key":"X6SaggHWWN"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"# ! mamba install --yes altair plotly","key":"pmdWVIklEE"},{"type":"outputs","id":"5vEmtxL9AwRSoHnOc7BQF","children":[],"key":"okwNK4VxOS"}],"key":"YMlhOusa52"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"import altair as alt\nimport matplotlib.pyplot as plt\n%matplotlib inline\nimport math\nimport numpy as np\nimport pandas as pd\n\nimport plotly.graph_objects as go\nfrom plotly.subplots import make_subplots\n\nfrom esa_climate_toolbox.core import get_op\nfrom esa_climate_toolbox.core import list_ecv_datasets\nfrom esa_climate_toolbox.core import open_data","key":"yrDMc52Agv"},{"type":"outputs","id":"G9h0jOMqlZKhCeUpVarpC","children":[{"type":"output","jupyter_data":{"name":"stderr","output_type":"stream","text":"/home/tonio/projects/xcube-dev/xcube/xcube/util/plugin.py:176: UserWarning: Initializing xcube plugin 'xcube' took 164 ms, consider code optimization. (For example, avoid eager import of packages, consider lazy loading of resources, etc.)\n  warnings.warn(\n"},"children":[],"key":"KVQHTRXp5q"}],"key":"iLKE2KiBgo"}],"key":"VoJczjL3Z9"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Once more, we start with listing the datasets that are potentially useful for our purpose. For more information on Ozone Data, visit ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"Kl2QAWmIct"},{"type":"link","url":"https://climate.esa.int/en/projects/ozone/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"https://​climate​.esa​.int​/en​/projects​/ozone/","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"AhLLV53Duy"}],"urlSource":"https://climate.esa.int/en/projects/ozone/","key":"fmeudtuDbH"},{"type":"text","value":".","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dFhmHHigwC"}],"key":"DJazf5oiSi"}],"key":"tq8QmK68ch"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"list_ecv_datasets(ecv=\"OZONE\")","key":"SHWn0H74LZ"},{"type":"outputs","id":"DvCaQC9XOmgsP2puee-lH","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":3,"metadata":{},"data":{"text/plain":{"content":"[('esacci.OZONE.day.L3S.TC.multi-sensor.multi-platform.MERGED.fv0100.r1',\n  'esa-cci'),\n ('esacci.OZONE.mon.L3.LP.GOMOS.Envisat.GOMOS_ENVISAT.v0001.r1', 'esa-cci'),\n ('esacci.OZONE.mon.L3.LP.MIPAS.Envisat.MIPAS_ENVISAT.v0001.r1', 'esa-cci'),\n ('esacci.OZONE.mon.L3.LP.OSIRIS.ODIN.OSIRIS_ODIN.v0001.r1', 'esa-cci'),\n ('esacci.OZONE.mon.L3.LP.SCIAMACHY.Envisat.SCIAMACHY_ENVISAT.v0001.r1',\n  'esa-cci'),\n ('esacci.OZONE.mon.L3.LP.SMR.ODIN.MZM.v0001.r1', 'esa-cci'),\n ('esacci.OZONE.mon.L3.LP.SMR.ODIN.SMR_ODIN.v0001.r1', 'esa-cci'),\n ('esacci.OZONE.mon.L3.NP.multi-sensor.multi-platform.MERGED.fv0002.r1',\n  'esa-cci')]","content_type":"text/plain"}}},"children":[],"key":"dhiuVQoPIS"}],"key":"bSMtSIAGBr"}],"key":"jytxvc6eI8"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Here, no zarr or kerchunk datasets are available, so we use data from the odp store. We pick the multi-sensor multi-platform dataset in a monthly resolution. We delimit the number of opened variables, so we only pick the weighted ozone average, and choose a temporal subset.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dQvtFonn8D"}],"key":"X33Rc7Rn8S"}],"key":"mg8hajZcxp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ozone_ds, _ = open_data(\n    \"esacci.OZONE.mon.L3.NP.multi-sensor.multi-platform.MERGED.fv0002.r1\", \n    var_names=\"O3_du\",\n    data_store_id=\"esa-cci\"\n)\nozone_ds","key":"ZbRuat9NR3"},{"type":"outputs","id":"cy5HmoaGJByPrMGK0rmkw","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":4,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"a3d586b6efb60ef8fb6ee7ab13361c97","path":"/cci-demonstrator-viewers/build/a3d586b6efb60ef8fb6ee7ab13361c97.html"},"text/plain":{"content":"<xarray.Dataset> Size: 597MB\nDimensions:       (time: 144, layers: 16, lat: 180, lon: 360, air_pressure: 17,\n                   bnds: 2)\nCoordinates:\n  * air_pressure  (air_pressure) float32 68B 1.013e+03 446.0 196.4 ... 0.05 0.01\n  * lat           (lat) float32 720B -89.5 -88.5 -87.5 -86.5 ... 87.5 88.5 89.5\n  * layers        (layers) int32 64B 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16\n  * lon           (lon) float32 1kB -179.5 -178.5 -177.5 ... 177.5 178.5 179.5\n  * time          (time) datetime64[ns] 1kB 1997-01-16T12:00:00 ... 2008-12-1...\n    time_bnds     (time, bnds) datetime64[ns] 2kB dask.array<chunksize=(144, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    O3_du         (time, layers, lat, lon) float32 597MB dask.array<chunksize=(1, 16, 180, 360), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.OZONE.mon.L3.NP.multi-sensor.multi-platfo...\n    date_created:            2025-04-08T09:50:13.180491\n    processing_level:        L3\n    time_coverage_start:     1997-01-01T00:00:00\n    time_coverage_end:       2009-01-01T00:00:00\n    time_coverage_duration:  P4383DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"PFIEbdhJmU"}],"key":"rRQ0ExGZJR"}],"key":"uR5lfJN9Ie"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The variable ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"EsK6HAr2i1"},{"type":"inlineCode","value":"O3_du","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"HWghnWnmG8"},{"type":"text","value":" has a fourth dimension, layers. The dataset still has a dimension ","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"IceKA8bL2H"},{"type":"inlineCode","value":"air_pressure","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"ecc6xnUS9T"},{"type":"text","value":" that is not needed anymore, as no variable makes use of it, so we drop it.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"BTJuT4eCYi"}],"key":"ULlbwgV7RI"}],"key":"qFRHAkwA2X"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ozone_ds = ozone_ds.drop_dims(\"air_pressure\")\nozone_ds","key":"ER5E3w5Wyn"},{"type":"outputs","id":"oQlCfy-611fC764d3PHTd","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":5,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"1913b00320fad5d1ccd42986715fa034","path":"/cci-demonstrator-viewers/build/1913b00320fad5d1ccd42986715fa034.html"},"text/plain":{"content":"<xarray.Dataset> Size: 597MB\nDimensions:    (time: 144, layers: 16, lat: 180, lon: 360, bnds: 2)\nCoordinates:\n  * lat        (lat) float32 720B -89.5 -88.5 -87.5 -86.5 ... 87.5 88.5 89.5\n  * layers     (layers) int32 64B 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16\n  * lon        (lon) float32 1kB -179.5 -178.5 -177.5 ... 177.5 178.5 179.5\n  * time       (time) datetime64[ns] 1kB 1997-01-16T12:00:00 ... 2008-12-16T1...\n    time_bnds  (time, bnds) datetime64[ns] 2kB dask.array<chunksize=(144, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    O3_du      (time, layers, lat, lon) float32 597MB dask.array<chunksize=(1, 16, 180, 360), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.OZONE.mon.L3.NP.multi-sensor.multi-platfo...\n    date_created:            2025-04-08T09:50:13.180491\n    processing_level:        L3\n    time_coverage_start:     1997-01-01T00:00:00\n    time_coverage_end:       2009-01-01T00:00:00\n    time_coverage_duration:  P4383DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"bTtNNrBF9G"}],"key":"ONICnBtac6"}],"key":"fxs1gaWTKe"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"subset_time_index = get_op(\"subset_temporal_index\")\nozone_sub_ds = subset_time_index(ozone_ds, 120, 144)\nozone_sub_ds","key":"Sk7B2PNreN"},{"type":"outputs","id":"XyH0AnbGOZZNp77YWjcez","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":6,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"201cd5b9bd04225958978732b8a1f681","path":"/cci-demonstrator-viewers/build/201cd5b9bd04225958978732b8a1f681.html"},"text/plain":{"content":"<xarray.Dataset> Size: 100MB\nDimensions:    (time: 24, layers: 16, lat: 180, lon: 360, bnds: 2)\nCoordinates:\n  * lat        (lat) float32 720B -89.5 -88.5 -87.5 -86.5 ... 87.5 88.5 89.5\n  * layers     (layers) int32 64B 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16\n  * lon        (lon) float32 1kB -179.5 -178.5 -177.5 ... 177.5 178.5 179.5\n  * time       (time) datetime64[ns] 192B 2007-01-16T12:00:00 ... 2008-12-16T...\n    time_bnds  (time, bnds) datetime64[ns] 384B dask.array<chunksize=(24, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    O3_du      (time, layers, lat, lon) float32 100MB dask.array<chunksize=(1, 16, 180, 360), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.OZONE.mon.L3.NP.multi-sensor.multi-platfo...\n    date_created:            2025-04-08T09:50:13.180491\n    processing_level:        L3\n    time_coverage_start:     1997-01-01T00:00:00\n    time_coverage_end:       2009-01-01T00:00:00\n    time_coverage_duration:  P4383DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"HxS0FevZAB"}],"key":"dPFq1FMBTl"}],"key":"bqBKYaqmil"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We create a time series for a point, given through a string encoded as “longitude, latitude”.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"uQbTulm6hT"}],"key":"JQpn7sdjn0"}],"key":"Q5H60pgEZR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"tpoint = get_op(\"tseries_point\")\nozone_point_ts = tpoint(ozone_sub_ds, point=\"10, 53.5\")\nozone_point_ts","key":"fCT6EBmTPG"},{"type":"outputs","id":"nVQIUN_HLQmbEkfesrTpn","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":7,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"3aad42d05ed0a462f54c1101929cefe5","path":"/cci-demonstrator-viewers/build/3aad42d05ed0a462f54c1101929cefe5.html"},"text/plain":{"content":"<xarray.Dataset> Size: 2kB\nDimensions:    (time: 24, layers: 16, bnds: 2)\nCoordinates:\n    lat        float32 4B 53.5\n  * layers     (layers) int32 64B 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16\n    lon        float32 4B 10.5\n  * time       (time) datetime64[ns] 192B 2007-01-16T12:00:00 ... 2008-12-16T...\n    time_bnds  (time, bnds) datetime64[ns] 384B dask.array<chunksize=(24, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    O3_du      (time, layers) float32 2kB dask.array<chunksize=(1, 16), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.OZONE.mon.L3.NP.multi-sensor.multi-platfo...\n    date_created:            2025-04-08T09:50:13.180491\n    processing_level:        L3\n    time_coverage_start:     1997-01-01T00:00:00\n    time_coverage_end:       2009-01-01T00:00:00\n    time_coverage_duration:  P4383DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"C7MlyIKdBX"}],"key":"Tqcdbr3mFB"}],"key":"dGp42GeOpB"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We now convert this to a dataframe that may be read from the visualisation libraries.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"dIsVENSIs9"}],"key":"mr0M1hQsIS"}],"key":"Q04V38y6DC"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"df_op  = get_op(\"to_dataframe\")\nozone_point_ts_df = df_op(ozone_point_ts)\nozone_point_ts_df","key":"MiEXapqYrj"},{"type":"outputs","id":"J1bvwdPaKkI5gsTus-83_","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":8,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th></th>\n      <th></th>\n      <th>O3_du</th>\n      <th>lat</th>\n      <th>lon</th>\n      <th>time_bnds</th>\n    </tr>\n    <tr>\n      <th>time</th>\n      <th>layers</th>\n      <th>bnds</th>\n      <th></th>\n      <th></th>\n      <th></th>\n      <th></th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th rowspan=\"5\" valign=\"top\">2007-01-16 12:00:00</th>\n      <th rowspan=\"2\" valign=\"top\">1</th>\n      <th>0</th>\n      <td>10.509481</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2007-01-01</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>10.509481</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2007-02-01</td>\n    </tr>\n    <tr>\n      <th rowspan=\"2\" valign=\"top\">2</th>\n      <th>0</th>\n      <td>11.720570</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2007-01-01</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>11.720570</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2007-02-01</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <th>0</th>\n      <td>13.219014</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2007-01-01</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <th>...</th>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th rowspan=\"5\" valign=\"top\">2008-12-16 12:00:00</th>\n      <th>14</th>\n      <th>1</th>\n      <td>0.235282</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2009-01-01</td>\n    </tr>\n    <tr>\n      <th rowspan=\"2\" valign=\"top\">15</th>\n      <th>0</th>\n      <td>0.109375</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2008-12-01</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>0.109375</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2009-01-01</td>\n    </tr>\n    <tr>\n      <th rowspan=\"2\" valign=\"top\">16</th>\n      <th>0</th>\n      <td>0.007546</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2008-12-01</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>0.007546</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2009-01-01</td>\n    </tr>\n  </tbody>\n</table>\n<p>768 rows × 4 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"                                     O3_du   lat   lon  time_bnds\ntime                layers bnds                                  \n2007-01-16 12:00:00 1      0     10.509481  53.5  10.5 2007-01-01\n                           1     10.509481  53.5  10.5 2007-02-01\n                    2      0     11.720570  53.5  10.5 2007-01-01\n                           1     11.720570  53.5  10.5 2007-02-01\n                    3      0     13.219014  53.5  10.5 2007-01-01\n...                                    ...   ...   ...        ...\n2008-12-16 12:00:00 14     1      0.235282  53.5  10.5 2009-01-01\n                    15     0      0.109375  53.5  10.5 2008-12-01\n                           1      0.109375  53.5  10.5 2009-01-01\n                    16     0      0.007546  53.5  10.5 2008-12-01\n                           1      0.007546  53.5  10.5 2009-01-01\n\n[768 rows x 4 columns]","content_type":"text/plain"}}},"children":[],"key":"u2q6ILbnrb"}],"key":"p16Ycmd5XN"}],"key":"taB56Y55o2"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"The resulting dataframe has a multi-index that is inconvenient to use, so we resolve it to be able to address the columns stating the index.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"X6Re4WFxT1"}],"key":"b0deP08PSP"}],"key":"bc0PfY89Al"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ozone_point_ts_df = ozone_point_ts_df.reset_index().rename(columns={'index': 'timestamp'})\nozone_point_ts_df","key":"KRDIJg4Fuj"},{"type":"outputs","id":"GT1EKb4CuB-gHb1kZV3y2","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":9,"metadata":{},"data":{"text/html":{"content":"<div>\n<style scoped>\n    .dataframe tbody tr th:only-of-type {\n        vertical-align: middle;\n    }\n\n    .dataframe tbody tr th {\n        vertical-align: top;\n    }\n\n    .dataframe thead th {\n        text-align: right;\n    }\n</style>\n<table border=\"1\" class=\"dataframe\">\n  <thead>\n    <tr style=\"text-align: right;\">\n      <th></th>\n      <th>time</th>\n      <th>layers</th>\n      <th>bnds</th>\n      <th>O3_du</th>\n      <th>lat</th>\n      <th>lon</th>\n      <th>time_bnds</th>\n    </tr>\n  </thead>\n  <tbody>\n    <tr>\n      <th>0</th>\n      <td>2007-01-16 12:00:00</td>\n      <td>1</td>\n      <td>0</td>\n      <td>10.509481</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2007-01-01</td>\n    </tr>\n    <tr>\n      <th>1</th>\n      <td>2007-01-16 12:00:00</td>\n      <td>1</td>\n      <td>1</td>\n      <td>10.509481</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2007-02-01</td>\n    </tr>\n    <tr>\n      <th>2</th>\n      <td>2007-01-16 12:00:00</td>\n      <td>2</td>\n      <td>0</td>\n      <td>11.720570</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2007-01-01</td>\n    </tr>\n    <tr>\n      <th>3</th>\n      <td>2007-01-16 12:00:00</td>\n      <td>2</td>\n      <td>1</td>\n      <td>11.720570</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2007-02-01</td>\n    </tr>\n    <tr>\n      <th>4</th>\n      <td>2007-01-16 12:00:00</td>\n      <td>3</td>\n      <td>0</td>\n      <td>13.219014</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2007-01-01</td>\n    </tr>\n    <tr>\n      <th>...</th>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n      <td>...</td>\n    </tr>\n    <tr>\n      <th>763</th>\n      <td>2008-12-16 12:00:00</td>\n      <td>14</td>\n      <td>1</td>\n      <td>0.235282</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2009-01-01</td>\n    </tr>\n    <tr>\n      <th>764</th>\n      <td>2008-12-16 12:00:00</td>\n      <td>15</td>\n      <td>0</td>\n      <td>0.109375</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2008-12-01</td>\n    </tr>\n    <tr>\n      <th>765</th>\n      <td>2008-12-16 12:00:00</td>\n      <td>15</td>\n      <td>1</td>\n      <td>0.109375</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2009-01-01</td>\n    </tr>\n    <tr>\n      <th>766</th>\n      <td>2008-12-16 12:00:00</td>\n      <td>16</td>\n      <td>0</td>\n      <td>0.007546</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2008-12-01</td>\n    </tr>\n    <tr>\n      <th>767</th>\n      <td>2008-12-16 12:00:00</td>\n      <td>16</td>\n      <td>1</td>\n      <td>0.007546</td>\n      <td>53.5</td>\n      <td>10.5</td>\n      <td>2009-01-01</td>\n    </tr>\n  </tbody>\n</table>\n<p>768 rows × 7 columns</p>\n</div>","content_type":"text/html"},"text/plain":{"content":"                   time  layers  bnds      O3_du   lat   lon  time_bnds\n0   2007-01-16 12:00:00       1     0  10.509481  53.5  10.5 2007-01-01\n1   2007-01-16 12:00:00       1     1  10.509481  53.5  10.5 2007-02-01\n2   2007-01-16 12:00:00       2     0  11.720570  53.5  10.5 2007-01-01\n3   2007-01-16 12:00:00       2     1  11.720570  53.5  10.5 2007-02-01\n4   2007-01-16 12:00:00       3     0  13.219014  53.5  10.5 2007-01-01\n..                  ...     ...   ...        ...   ...   ...        ...\n763 2008-12-16 12:00:00      14     1   0.235282  53.5  10.5 2009-01-01\n764 2008-12-16 12:00:00      15     0   0.109375  53.5  10.5 2008-12-01\n765 2008-12-16 12:00:00      15     1   0.109375  53.5  10.5 2009-01-01\n766 2008-12-16 12:00:00      16     0   0.007546  53.5  10.5 2008-12-01\n767 2008-12-16 12:00:00      16     1   0.007546  53.5  10.5 2009-01-01\n\n[768 rows x 7 columns]","content_type":"text/plain"}}},"children":[],"key":"RgwV0RQPdd"}],"key":"aJyvQq0QDi"}],"key":"NWDeSjAR4W"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We now create a chart from this dataframe, where each layer dimension receives a different color, allowing to visualize them in the same chart.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"LRqGtLGw7U"}],"key":"eto9kNEJtq"}],"key":"SP9Hw4eiUR"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"alt.Chart(ozone_point_ts_df).mark_line().encode(\n    x='time:T',\n    y='O3_du:Q',\n    color='layers:N'\n)","key":"NKCHKzdkcI"},{"type":"outputs","id":"Uu-KIYI6UiYsKVr4rHfVm","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":10,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"1f23a9f4295aae4d860422316d4dd3cc","path":"/cci-demonstrator-viewers/build/1f23a9f4295aae4d860422316d4dd3cc.html"},"text/plain":{"content":"alt.Chart(...)","content_type":"text/plain"}}},"children":[],"key":"XZnzcEk0V4"}],"key":"S1cgxUUpo1"}],"key":"CMqRBtB2Yt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Like in the notebook on visualizing uncertainties, we are not only interested in showing the layer dimension of a time-series without spatial extent, but also of a grid for a single timestep. For this, we select the last time step ot the ozone dataset. For this, we again use plotly. Whilst we created a single plot in the previous notebook, we will now go on to create one surface area per layer dimension.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"XyUO8mkmo5"}],"key":"FJcPpBwg0Q"}],"key":"iW4nTok2Qr"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"subset_time_index = get_op(\"subset_temporal_index\")\nozone_sub_ds = subset_time_index(ozone_ds, 143, 144)\nozone_sub_ds","key":"MJw2IYnaSI"},{"type":"outputs","id":"J8bPdMpcb1m4N5CQMyNUN","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":11,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"5c39c1184680bef7bca24f63db6c04e7","path":"/cci-demonstrator-viewers/build/5c39c1184680bef7bca24f63db6c04e7.html"},"text/plain":{"content":"<xarray.Dataset> Size: 4MB\nDimensions:    (time: 1, layers: 16, lat: 180, lon: 360, bnds: 2)\nCoordinates:\n  * lat        (lat) float32 720B -89.5 -88.5 -87.5 -86.5 ... 87.5 88.5 89.5\n  * layers     (layers) int32 64B 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16\n  * lon        (lon) float32 1kB -179.5 -178.5 -177.5 ... 177.5 178.5 179.5\n  * time       (time) datetime64[ns] 8B 2008-12-16T12:00:00\n    time_bnds  (time, bnds) datetime64[ns] 16B dask.array<chunksize=(1, 2), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    O3_du      (time, layers, lat, lon) float32 4MB dask.array<chunksize=(1, 16, 180, 360), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.OZONE.mon.L3.NP.multi-sensor.multi-platfo...\n    date_created:            2025-04-08T09:50:13.180491\n    processing_level:        L3\n    time_coverage_start:     1997-01-01T00:00:00\n    time_coverage_end:       2009-01-01T00:00:00\n    time_coverage_duration:  P4383DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"ddKWkd0Tj1"}],"key":"cmAMUXG2tm"}],"key":"lrEHF6kadm"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We want to remove the time dimension from the dataset so we have a leaner data array to work with.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"hkyDFLGviz"}],"key":"IuuOluq2pA"}],"key":"TiFrIeCl07"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"ozone_sub_ds = ozone_sub_ds.squeeze()\nozone_sub_ds","key":"WUBXm3i0JX"},{"type":"outputs","id":"6ZNRBKW8T1kGa4q37qW5N","children":[{"type":"output","jupyter_data":{"output_type":"execute_result","execution_count":12,"metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"90ececb32d99bdbb184679c5c866d7da","path":"/cci-demonstrator-viewers/build/90ececb32d99bdbb184679c5c866d7da.html"},"text/plain":{"content":"<xarray.Dataset> Size: 4MB\nDimensions:    (layers: 16, lat: 180, lon: 360, bnds: 2)\nCoordinates:\n  * lat        (lat) float32 720B -89.5 -88.5 -87.5 -86.5 ... 87.5 88.5 89.5\n  * layers     (layers) int32 64B 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16\n  * lon        (lon) float32 1kB -179.5 -178.5 -177.5 ... 177.5 178.5 179.5\n    time       datetime64[ns] 8B 2008-12-16T12:00:00\n    time_bnds  (bnds) datetime64[ns] 16B dask.array<chunksize=(2,), meta=np.ndarray>\nDimensions without coordinates: bnds\nData variables:\n    O3_du      (layers, lat, lon) float32 4MB dask.array<chunksize=(16, 180, 360), meta=np.ndarray>\nAttributes:\n    Conventions:             CF-1.7\n    title:                   esacci.OZONE.mon.L3.NP.multi-sensor.multi-platfo...\n    date_created:            2025-04-08T09:50:13.180491\n    processing_level:        L3\n    time_coverage_start:     1997-01-01T00:00:00\n    time_coverage_end:       2009-01-01T00:00:00\n    time_coverage_duration:  P4383DT0H0M0S\n    history:                 [{'program': 'xcube_cci.chunkstore.CciChunkStore...","content_type":"text/plain"}}},"children":[],"key":"tHWnEKvz9h"}],"key":"DoYxr2hIyX"}],"key":"Z1VZAs1Okt"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"Good. Now this is done, we can prepare the plots. There are sixteen layers, so we set up a structure of 8 rows and 2 columns.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"q8OqMqFaqc"}],"key":"OsbFst3BBv"}],"key":"dgFClOEB5M"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"fig = make_subplots(\n    rows=8,     \n    cols=2,\n    subplot_titles=(\n        \"Layer 1\", \"Layer 2\", \"Layer 3\", \"Layer 4\",\n        \"Layer 5\", \"Layer 6\", \"Layer 7\", \"Layer 8\",\n        \"Layer 9\", \"Layer 10\", \"Layer 11\", \"Layer 12\",\n        \"Layer 13\", \"Layer 14\", \"Layer 15\", \"Layer 16\"\n    ),\n    specs=[[{'type': 'surface'}, {'type': 'surface'}],\n           [{'type': 'surface'}, {'type': 'surface'}],\n           [{'type': 'surface'}, {'type': 'surface'}],\n           [{'type': 'surface'}, {'type': 'surface'}],\n           [{'type': 'surface'}, {'type': 'surface'}],\n           [{'type': 'surface'}, {'type': 'surface'}],\n           [{'type': 'surface'}, {'type': 'surface'}],\n           [{'type': 'surface'}, {'type': 'surface'}]\n          ]    \n)","key":"wDszHnN8hq"},{"type":"outputs","id":"bajKNoi0pJzmlN0cBB04L","children":[],"key":"Nuk5e65mYP"}],"key":"lPDhI60w9c"},{"type":"block","kind":"notebook-content","children":[{"type":"paragraph","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"children":[{"type":"text","value":"We can now create the surfaces. In each surface, latitude and longitude will stand for the x and y dimensions. The z-values will show the ozone average for the layer in question.","position":{"start":{"line":1,"column":1},"end":{"line":1,"column":1}},"key":"YPDzN3lGfd"}],"key":"CVtUMSQ3z5"}],"key":"le4LLIOVOp"},{"type":"block","kind":"notebook-code","children":[{"type":"code","lang":"python","executable":true,"value":"y = ozone_sub_ds.lat.values\nx = ozone_sub_ds.lon.values\n\nfor i in range(len(ozone_sub_ds.layers)):\n    r = math.floor(i / 2) + 1    \n    c = math.floor(i % 2) + 1\n    print(f\"Creating plot for layer at {r}, {c}\")\n    z = ozone_sub_ds.O3_du.isel(layers=i).values\n    layer_number = ozone_sub_ds.layers.isel(layers=i).values\n    fig.add_trace(\n        go.Surface(x=x, y=y, z=z, showscale=False, name=f\"Layer {layer_number}\"),\n        row=r, \n        col=c,        \n    )\nfig.update_layout(\n    title_text='Different layers of mole content of ozone in the different atmosphere layers',\n    height=1600,\n    width=1200,\n    showlegend=True\n)\nfig.update_layout(margin=dict(t=100))\nfig.show()","key":"JFS5FfdNEf"},{"type":"outputs","id":"sFpfdKisvQFyeHwBv5e-9","children":[{"type":"output","jupyter_data":{"name":"stdout","output_type":"stream","text":"Creating plot for layer at 1, 1\nCreating plot for layer at 1, 2\nCreating plot for layer at 2, 1\nCreating plot for layer at 2, 2\nCreating plot for layer at 3, 1\nCreating plot for layer at 3, 2\nCreating plot for layer at 4, 1\nCreating plot for layer at 4, 2\nCreating plot for layer at 5, 1\nCreating plot for layer at 5, 2\nCreating plot for layer at 6, 1\nCreating plot for layer at 6, 2\nCreating plot for layer at 7, 1\nCreating plot for layer at 7, 2\nCreating plot for layer at 8, 1\nCreating plot for layer at 8, 2\n"},"children":[],"key":"bUKdocXzpy"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"text/html":{"content_type":"text/html","hash":"ec67c2e5476e3e5f76b381888d3e33f4","path":"/cci-demonstrator-viewers/build/ec67c2e5476e3e5f76b381888d3e33f4.html"}}},"children":[],"key":"g3K7DndxRR"},{"type":"output","jupyter_data":{"output_type":"display_data","metadata":{},"data":{"application/vnd.plotly.v1+json":{"content_type":"application/vnd.plotly.v1+json","hash":"cfb8a0001737a0037acf1e014f37ef91","path":"/cci-demonstrator-viewers/build/cfb8a0001737a0037acf1e014f37ef91.json"},"text/html":{"content_type":"text/html","hash":"842d1be2834557fe8f343c4a332070b1","path":"/cci-demonstrator-viewers/build/842d1be2834557fe8f343c4a332070b1.html"}}},"children":[],"key":"bDNByVQLUa"}],"key":"XQ3NOVrS6F"}],"key":"xLaXqy5lev"}],"key":"jku8jcLPK2"},"references":{"cite":{"order":[],"data":{}}},"footer":{"navigation":{"prev":{"title":"Visualizing Cloud Fraction Uncertainties with Altair and Plotly","url":"/external-notebooks/esa-cci/ect-demonstrators/demonstrators/d3-js/d3-js-visualise-uncertainties","group":"D3 Js"}}},"domain":"http://localhost:3000"}